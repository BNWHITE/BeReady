<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus R√©visions ISEP - Excellence Acad√©mique</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* RESET ET STYLES DE BASE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2c5aa0;
            --primary-dark: #1e3d72;
            --secondary: #4CAF50;
            --accent: #FF6B35;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: var(--light);
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        button {
            cursor: pointer;
            border: none;
            font-family: inherit;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* HEADER */
        .main-header {
            background: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-link {
            font-weight: 500;
            padding: 8px 0;
            position: relative;
            transition: var(--transition);
        }

        .nav-link:hover, .nav-link.active {
            color: var(--primary);
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .login-btn, .logout-btn {
            background: var(--primary);
            color: white;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .login-btn:hover, .logout-btn:hover {
            background: var(--primary-dark);
        }

        .logout-btn {
            background: var(--gray);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* HERO SECTION */
        .hero-section {
            padding: 80px 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .hero-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
        }

        .tagline {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 20px;
        }

        .hero-description {
            font-size: 1.1rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .hero-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .cta-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--accent);
            color: white;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-weight: 600;
            transition: var(--transition);
        }

        .cta-button:hover {
            background: #e55a2b;
            transform: translateY(-2px);
        }

        .cta-button.secondary {
            background: transparent;
            border: 2px solid white;
        }

        .cta-button.secondary:hover {
            background: white;
            color: var(--primary);
        }

        .hero-image {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .hero-image-placeholder {
            width: 100%;
            height: 300px;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.2) 100%);
            border-radius: var(--border-radius);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            color: rgba(255,255,255,0.7);
        }

        /* STATS BAR */
        .stats-bar {
            background: white;
            padding: 40px 0;
            box-shadow: var(--shadow);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--gray);
            font-weight: 500;
        }

        /* SECTIONS */
        .section {
            padding: 80px 0;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .section-description {
            text-align: center;
            max-width: 700px;
            margin: 0 auto 40px;
            color: var(--gray);
            font-size: 1.1rem;
        }

        .separator {
            border: none;
            height: 1px;
            background: var(--light-gray);
            margin: 40px 0;
        }

        /* PROGRESS INDICATOR */
        .progress-indicator {
            background: var(--light);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            display: none;
        }

        .progress-bar {
            height: 10px;
            background: var(--light-gray);
            border-radius: 5px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--secondary);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        /* TD GRID */
        .td-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .td-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 4px solid var(--primary);
            cursor: pointer;
        }

        .td-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .td-card.completed {
            border-left-color: var(--secondary);
        }

        .locked-card {
            opacity: 0.7;
            background: var(--light-gray);
            cursor: not-allowed;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .td-card h3 {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .difficulty {
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }

        .difficulty.easy {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .difficulty.medium {
            background: #fff3e0;
            color: #ef6c00;
        }

        .difficulty.hard {
            background: #ffebee;
            color: #c62828;
        }

        .card-footer {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
        }

        .completion-badge {
            color: var(--secondary);
            font-weight: 600;
        }

        .time-estimate {
            color: var(--gray);
        }

        .locked-badge {
            color: var(--gray);
        }

        /* TELECOM FEATURES */
        .telecom-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .feature {
            text-align: center;
            padding: 30px 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .feature:hover {
            transform: translateY(-5px);
        }

        .feature i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .feature h4 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .secondary-cta {
            display: block;
            width: fit-content;
            margin: 30px auto 0;
            background: var(--primary);
        }

        .secondary-cta:hover {
            background: var(--primary-dark);
        }

        /* TESTIMONIALS */
        .testimonials {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .testimonial {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            position: relative;
        }

        .testimonial::before {
            content: '"';
            font-size: 4rem;
            color: var(--light-gray);
            position: absolute;
            top: 10px;
            left: 20px;
            line-height: 1;
        }

        .testimonial-content {
            margin-bottom: 20px;
            font-style: italic;
            position: relative;
            z-index: 1;
        }

        .testimonial-author {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .testimonial-author strong {
            color: var(--primary);
        }

        .testimonial-author span {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* NEWSLETTER */
        .newsletter-section {
            background: var(--light);
            padding: 60px 0;
            text-align: center;
        }

        .newsletter-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .newsletter-form {
            display: flex;
            gap: 10px;
            margin: 30px 0 20px;
        }

        .newsletter-form input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .privacy-note {
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* FOOTER */
        .main-footer {
            background: var(--dark);
            color: white;
            padding: 30px 0;
            text-align: center;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 400px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .close-modal {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }

        .input-help {
            display: block;
            margin-top: 5px;
            font-size: 0.8rem;
            color: var(--gray);
        }

        .modal-note {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 20px;
            text-align: center;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* NOTIFICATIONS */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 0;
            border-radius: 8px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 400px;
            animation: slideInRight 0.3s ease;
        }

        .notification.success {
            background: var(--secondary);
            color: white;
        }

        .notification.error {
            background: #f44336;
            color: white;
        }

        .notification.info {
            background: var(--primary);
            color: white;
        }

        .notification-content {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .notification-close {
            background: none;
            border: none;
            color: inherit;
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: 15px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* RESPONSIVE */
        @media (max-width: 992px) {
            .hero-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-links {
                gap: 15px;
            }
            
            .hero-title {
                font-size: 2rem;
            }
            
            .hero-actions {
                justify-content: center;
            }
            
            .newsletter-form {
                flex-direction: column;
            }
            
            .td-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 576px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .testimonials {
                grid-template-columns: 1fr;
            }
            
            .telecom-features {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Modal de connexion -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Connexion √† Focus ISEP</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Pseudo *</label>
                    <input type="text" id="username" name="username" required minlength="3">
                    <small class="input-help">Minimum 3 caract√®res</small>
                </div>
                <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" name="email" required>
                    <small class="input-help">Votre email ISEP de pr√©f√©rence</small>
                </div>
                <button type="submit" class="cta-button" id="loginSubmitBtn" style="width: 100%; justify-content: center;">
                    <span id="loginBtnText">Se connecter / S'inscrire</span>
                    <div id="loginSpinner" class="spinner" style="display: none;"></div>
                </button>
            </form>
            <p class="modal-note">üîê Pas de mot de passe requis ! Votre pseudo et email suffisent.</p>
        </div>
    </div>

    <section id="home" class="page active">
        <header class="main-header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">FOCUS ISEP</div>
                    <nav class="nav-links">
                        <a href="#home" class="nav-link active">Accueil</a>
                        <a href="#proba-tds" class="nav-link">TDs Proba</a>
                        <a href="#telecom-rev" class="nav-link">R√©vision T√©l√©com</a>
                    </nav>
                    <div id="userSection" class="user-section">
                        <button id="loginBtn" class="login-btn">
                            <i class="fas fa-user"></i> Se connecter
                        </button>
                        <div id="userInfo" class="user-info" style="display: none;">
                            <span id="userGreeting">Bonjour, </span>
                            <button id="logoutBtn" class="logout-btn">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <section class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <div>
                        <span class="tagline">OPTIMISEZ VOTRE R√âVISION</span>
                        <h1 class="hero-title">Ma√Ætriser les Probabilit√©s et les R√©seaux avec Pr√©cision</h1>
                        <p class="hero-description">Acc√©dez √† des fiches de r√©vision structur√©es, des exercices corrig√©s pas √† pas, et un r√©sum√© complet des concepts cl√©s en T√©l√©communications pour une pr√©paration cibl√©e et efficace.</p>
                        <div class="hero-actions">
                            <a href="#proba-tds" class="cta-button">Commencer les TDs Proba ‚Üí</a>
                            <a href="#newsletter" class="cta-button secondary">Recevoir des fiches gratuites</a>
                        </div>
                    </div>
                    <div class="hero-image">
                        <div class="hero-image-placeholder">
                            <i class="fas fa-graduation-cap" style="font-size: 4rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="stats-bar">
            <div class="container">
                <div class="stats-container">
                    <div class="stat-item">
                        <p class="stat-number" id="totalUsers">0</p>
                        <p class="stat-label">√âtudiants inscrits</p>
                    </div>
                    <div class="stat-item">
                        <p class="stat-number">5</p>
                        <p class="stat-label">TDs de Proba</p>
                    </div>
                    <div class="stat-item">
                        <p class="stat-number">1</p>
                        <p class="stat-label">Fiche T√©l√©com Compl√®te</p>
                    </div>
                    <div class="stat-item">
                        <p class="stat-number">100%</p>
                        <p class="stat-label">Contenu Cible</p>
                    </div>
                </div>
            </div>
        </section>

        <div class="container">
            <hr class="separator">

            <section id="proba-tds" class="section">
                <h2 class="section-title">Modules de Travaux Dirig√©s (TD) - Probabilit√©s</h2>
                <p class="section-description">Cliquez sur un module pour acc√©der √† la fiche de r√©vision compl√®te et aux exercices corrig√©s.</p>
                
                <div id="progressIndicator" class="progress-indicator">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                    </div>
                    <span id="progressText">Votre progression: 0/5 TDs compl√©t√©s</span>
                </div>
                
                <div class="td-grid">
                    <div class="td-card" data-td="1">
                        <div class="card-header">
                            <h3>TD1</h3>
                            <span class="difficulty easy">Facile</span>
                        </div>
                        <p>Probabilit√©s Conditionnelles & Ind√©pendance</p>
                        <div class="card-footer">
                            <span class="time-estimate"><i class="far fa-clock"></i> ~1.5h</span>
                        </div>
                    </div>
                    <div class="td-card" data-td="2">
                        <div class="card-header">
                            <h3>TD2</h3>
                            <span class="difficulty medium">Moyen</span>
                        </div>
                        <p>Variables Al√©atoires Discr√®tes : Binomiale, Poisson...</p>
                        <div class="card-footer">
                            <span class="time-estimate"><i class="far fa-clock"></i> ~2h</span>
                        </div>
                    </div>
                    <div class="td-card" data-td="3">
                        <div class="card-header">
                            <h3>TD3</h3>
                            <span class="difficulty medium">Moyen</span>
                        </div>
                        <p>Variables Al√©atoires Continues & Loi Normale</p>
                        <div class="card-footer">
                            <span class="time-estimate"><i class="far fa-clock"></i> ~2h</span>
                        </div>
                    </div>
                    <div class="td-card" data-td="4">
                        <div class="card-header">
                            <h3>TD4</h3>
                            <span class="difficulty hard">Difficile</span>
                        </div>
                        <p>Couples de Variables Al√©atoires : Loi Jointe & Marginales</p>
                        <div class="card-footer">
                            <span class="time-estimate"><i class="far fa-clock"></i> ~2.5h</span>
                        </div>
                    </div>
                    <div class="td-card" data-td="5">
                        <div class="card-header">
                            <h3>TD5</h3>
                            <span class="difficulty hard">Difficile</span>
                        </div>
                        <p>Vecteurs Gaussiens & Covariance</p>
                        <div class="card-footer">
                            <span class="time-estimate"><i class="far fa-clock"></i> ~3h</span>
                        </div>
                    </div>
                    <div class="td-card locked-card">
                        <div class="card-header">
                            <h3>TD6</h3>
                            <span class="difficulty">√Ä venir</span>
                        </div>
                        <p>Estimation et Th√©or√®mes Limites (√Ä venir)</p>
                        <div class="card-footer">
                            <span class="locked-badge"><i class="fas fa-lock"></i> Bient√¥t disponible</span>
                        </div>
                    </div>
                </div>
            </section>

            <hr class="separator">

            <section id="telecom-rev" class="section">
                <h2 class="section-title">R√©vision Compl√®te - T√©l√©communications</h2>
                <p class="section-description">Synth√®se ultra-d√©taill√©e des concepts cl√©s : Bilan de Liaison (PIRE, $P_r$), Th√©or√®me de Shannon, SINR, Affaiblissement (LTE, Wi-Fi, Fibre).</p>
                
                <div class="telecom-features">
                    <div class="feature">
                        <i class="fas fa-chart-line"></i>
                        <h4>Bilan de Liaison</h4>
                        <p>Comprenez PIRE, puissance re√ßue et calculs d'affaiblissement</p>
                    </div>
                    <div class="feature">
                        <i class="fas fa-bolt"></i>
                        <h4>Th√©or√®me de Shannon</h4>
                        <p>Ma√Ætrisez la capacit√© maximale d'un canal de communication</p>
                    </div>
                    <div class="feature">
                        <i class="fas fa-wifi"></i>
                        <h4>Technologies R√©seau</h4>
                        <p>LTE, Wi-Fi, Fibre optique et leurs sp√©cificit√©s</p>
                    </div>
                </div>
                
                <a href="telecom.html" class="cta-button secondary-cta">Acc√©der √† la Fiche T√©l√©com Compl√®te ‚Üí</a>
            </section>

            <hr class="separator">

            <section id="temoignages" class="section">
                <h2 class="section-title">Ce que disent nos √©tudiants</h2>
                <div class="testimonials">
                    <div class="testimonial">
                        <div class="testimonial-content">
                            <p>"Gr√¢ce √† ces fiches, j'ai enfin compris les probabilit√©s conditionnelles qui me posaient probl√®me depuis des mois. Les explications pas √† pas sont incroyablement claires."</p>
                        </div>
                        <div class="testimonial-author">
                            <strong>Marie L.</strong>
                            <span>√âtudiante en 2√®me ann√©e</span>
                        </div>
                    </div>
                    <div class="testimonial">
                        <div class="testimonial-content">
                            <p>"La fiche t√©l√©com m'a sauv√© pour mon partiel. Tout est synth√©tis√© de mani√®re logique avec des exemples concrets. Je recommande √† 100%!"</p>
                        </div>
                        <div class="testimonial-author">
                            <strong>Thomas D.</strong>
                            <span>√âtudiant en 3√®me ann√©e</span>
                        </div>
                    </div>
                    <div class="testimonial">
                        <div class="testimonial-content">
                            <p>"Le syst√®me de progression m'a motiv√© √† terminer tous les TDs. J'ai am√©lior√© ma moyenne de 2 points en probabilit√©s!"</p>
                        </div>
                        <div class="testimonial-author">
                            <strong>Alexandre P.</strong>
                            <span>√âtudiant en 2√®me ann√©e</span>
                        </div>
                    </div>
                </div>
            </section>

            <hr class="separator">

            <section id="newsletter" class="newsletter-section">
                <div class="container">
                    <div class="newsletter-content">
                        <h2>Recevez des fiches de r√©vision gratuites</h2>
                        <p>Inscrivez-vous pour recevoir des r√©sum√©s de cours, des exercices suppl√©mentaires et des astuces de r√©vision directement dans votre bo√Æte mail.</p>
                        
                        <div id="newsletterFormContainer">
                            <form id="newsletterForm" class="newsletter-form">
                                <input type="email" id="newsletterEmail" placeholder="Votre adresse email" required>
                                <button type="submit" class="cta-button">S'inscrire √† la newsletter</button>
                            </form>
                        </div>
                        
                        <div id="newsletterStatus" style="display: none;"></div>
                        <p class="privacy-note">Nous respectons votre vie priv√©e. D√©sabonnez-vous √† tout moment.</p>
                    </div>
                </div>
            </section>
        </div>
        
        <footer class="main-footer">
            <div class="container">
                <p>&copy; 2025 Focus ISEP R√©visions. Tous droits r√©serv√©s - Seydi.</p>
            </div>
        </footer>
    </section>

    <script>
        // Configuration Supabase
        const SUPABASE_URL = 'https://eznzfgcwbqcckkvhsdhi.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_6WhkWn3e1Gdy8DTnkLmjMA_O10roVtv'
        // Initialisation Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Gestion de l'√©tat utilisateur
        let currentUser = null;
        let userProgress = {};

        // Gestion de l'authentification - VERSION CORRIG√âE
        class AuthManager {
            constructor() {
                this.currentUser = null;
                this.init();
            }

            async init() {
                console.log('üîß Initialisation AuthManager avec Supabase...');
                
                // Test de connexion √† Supabase
                try {
                    const { data, error } = await supabase.from('users').select('count', { count: 'exact', head: true });
                    if (error) {
                        console.error('‚ùå Erreur connexion Supabase:', error);
                        if (error.message.includes('relation "users" does not exist')) {
                            console.error('‚ö†Ô∏è La table "users" n\'existe pas. Cr√©ez-la d\'abord dans Supabase.');
                        }
                    } else {
                        console.log('‚úÖ Connexion Supabase r√©ussie!');
                    }
                } catch (error) {
                    console.error('‚ùå Erreur lors du test de connexion:', error);
                }

                // V√©rifier si l'utilisateur est d√©j√† connect√©
                const savedUser = localStorage.getItem('focusUser');
                if (savedUser) {
                    try {
                        this.currentUser = JSON.parse(savedUser);
                        this.updateUI();
                        await this.loadUserProgress();
                        await this.updateStats();
                    } catch (e) {
                        console.error('Erreur parsing saved user:', e);
                        localStorage.removeItem('focusUser');
                    }
                }
                
                await this.updateStats();
            }

            async login(username, email) {
                const submitBtn = document.getElementById('loginSubmitBtn');
                const btnText = document.getElementById('loginBtnText');
                const spinner = document.getElementById('loginSpinner');
                
                // Afficher le spinner
                btnText.textContent = 'Connexion...';
                spinner.style.display = 'inline-block';
                submitBtn.disabled = true;

                try {
                    console.log('üîê Tentative de connexion:', { username, email });

                    // V√©rifier d'abord si l'utilisateur existe
                    const { data: existingUser, error: checkError } = await supabase
                        .from('users')
                        .select('*')
                        .or(`username.eq.${username},email.eq.${email}`)
                        .maybeSingle();

                    let user;
                    
                    if (existingUser) {
                        // Utilisateur existant
                        console.log('üë§ Utilisateur existant trouv√©');
                        user = existingUser;
                        
                        // Mettre √† jour last_login
                        const { error: updateError } = await supabase
                            .from('users')
                            .update({ last_login: new Date().toISOString() })
                            .eq('id', user.id);
                            
                        if (updateError) {
                            console.warn('‚ö†Ô∏è Erreur mise √† jour last_login:', updateError);
                        }
                    } else {
                        // Nouvel utilisateur - cr√©ation
                        console.log('üÜï Cr√©ation nouvel utilisateur');
                        const { data: newUser, error: insertError } = await supabase
                            .from('users')
                            .insert([{ 
                                username, 
                                email,
                                created_at: new Date().toISOString(),
                                last_login: new Date().toISOString()
                            }])
                            .select()
                            .single();
                        
                        if (insertError) {
                            console.error('‚ùå Erreur cr√©ation utilisateur:', insertError);
                            throw insertError;
                        }
                        user = newUser;
                        console.log('‚úÖ Nouvel utilisateur cr√©√©:', user);
                    }

                    this.currentUser = user;
                    localStorage.setItem('focusUser', JSON.stringify(user));
                    this.updateUI();
                    await this.loadUserProgress();
                    await this.updateStats();
                    
                    return { success: true, user };
                    
                } catch (error) {
                    console.error('‚ùå Erreur de connexion:', error);
                    
                    let errorMessage = 'Erreur de connexion';
                    
                    if (error.code === '23505') {
                        errorMessage = 'Ce pseudo ou email est d√©j√† utilis√©';
                    } else if (error.message.includes('JWT')) {
                        errorMessage = 'Erreur de configuration Supabase';
                    } else if (error.message.includes('relation "users" does not exist')) {
                        errorMessage = 'Base de donn√©es non configur√©e. Contactez l\'administrateur.';
                    } else {
                        errorMessage = error.message || 'Erreur inconnue';
                    }
                    
                    return { success: false, error: errorMessage };
                } finally {
                    btnText.textContent = 'Se connecter / S\'inscrire';
                    spinner.style.display = 'none';
                    submitBtn.disabled = false;
                }
            }

            logout() {
                this.currentUser = null;
                localStorage.removeItem('focusUser');
                this.updateUI();
                userProgress = {};
                this.updateProgressUI();
                this.updateStats();
                showNotification('üëã D√©connexion r√©ussie', 'info');
            }

            updateUI() {
                const loginBtn = document.getElementById('loginBtn');
                const userInfo = document.getElementById('userInfo');
                const userGreeting = document.getElementById('userGreeting');
                const progressIndicator = document.getElementById('progressIndicator');

                if (this.currentUser) {
                    loginBtn.style.display = 'none';
                    userInfo.style.display = 'flex';
                    userGreeting.textContent = `Bonjour, ${this.currentUser.username}`;
                    if (progressIndicator) progressIndicator.style.display = 'block';
                } else {
                    loginBtn.style.display = 'block';
                    userInfo.style.display = 'none';
                    if (progressIndicator) progressIndicator.style.display = 'none';
                }
            }

            async loadUserProgress() {
                if (!this.currentUser) return;

                try {
                    console.log('üìä Chargement progression pour:', this.currentUser.id);
                    const { data, error } = await supabase
                        .from('td_progress')
                        .select('*')
                        .eq('user_id', this.currentUser.id);

                    if (error) {
                        if (error.message.includes('relation "td_progress" does not exist')) {
                            console.warn('‚ö†Ô∏è Table td_progress non trouv√©e');
                            return;
                        }
                        throw error;
                    }

                    userProgress = {};
                    if (data) {
                        data.forEach(progress => {
                            userProgress[progress.td_number] = progress;
                        });
                    }

                    console.log('‚úÖ Progression charg√©e:', userProgress);
                    this.updateProgressUI();
                    this.updateTDCards();
                    
                } catch (error) {
                    console.error('‚ùå Erreur chargement progression:', error);
                }
            }

            updateProgressUI() {
                if (!this.currentUser) return;

                const completedTDs = Object.values(userProgress).filter(p => p.is_completed).length;
                const totalTDs = 5;
                const progressPercent = (completedTDs / totalTDs) * 100;

                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                
                if (progressFill && progressText) {
                    progressFill.style.width = `${progressPercent}%`;
                    progressText.textContent = `Votre progression: ${completedTDs}/${totalTDs} TDs compl√©t√©s`;
                }
            }

            updateTDCards() {
                const tdCards = document.querySelectorAll('.td-card:not(.locked-card)');
                
                tdCards.forEach(card => {
                    const tdNumber = parseInt(card.getAttribute('data-td'));
                    if (!tdNumber) return;
                    
                    const progress = userProgress[tdNumber];
                    
                    if (progress && progress.is_completed) {
                        card.classList.add('completed');
                        let footer = card.querySelector('.card-footer');
                        if (!footer) {
                            footer = document.createElement('div');
                            footer.className = 'card-footer';
                            card.appendChild(footer);
                        }
                        footer.innerHTML = `<span class="completion-badge"><i class="fas fa-check"></i> Compl√©t√©</span>`;
                    }
                });
            }

            async updateStats() {
                try {
                    const { count, error } = await supabase
                        .from('users')
                        .select('*', { count: 'exact', head: true });

                    if (error) {
                        if (error.message.includes('relation "users" does not exist')) {
                            console.warn('‚ö†Ô∏è Table users non trouv√©e pour les stats');
                            return;
                        }
                        throw error;
                    }

                    if (!error && count !== null) {
                        const totalUsersElement = document.getElementById('totalUsers');
                        if (totalUsersElement) {
                            totalUsersElement.textContent = count;
                        }
                    }
                } catch (error) {
                    console.error('‚ùå Erreur mise √† jour stats:', error);
                }
            }

            isLoggedIn() {
                return this.currentUser !== null;
            }
        }

        // Gestion de la progression
        class ProgressManager {
            static async markTDCompleted(tdNumber, score = null, timeSpent = null) {
                if (!authManager.currentUser) {
                    showNotification('üîê Veuillez vous connecter pour enregistrer votre progression.', 'info');
                    return false;
                }

                try {
                    const progressData = {
                        user_id: authManager.currentUser.id,
                        td_number: tdNumber,
                        is_completed: true,
                        completed_at: new Date().toISOString(),
                        score: score,
                        time_spent: timeSpent,
                        last_accessed: new Date().toISOString()
                    };

                    console.log('üíæ Sauvegarde progression:', progressData);

                    const { data, error } = await supabase
                        .from('td_progress')
                        .upsert(progressData, { onConflict: 'user_id,td_number' })
                        .select()
                        .single();

                    if (error) throw error;

                    userProgress[tdNumber] = data;
                    authManager.updateProgressUI();
                    authManager.updateTDCards();
                    
                    showNotification('‚úÖ Progression sauvegard√©e !', 'success');
                    return true;
                    
                } catch (error) {
                    console.error('‚ùå Erreur sauvegarde progression:', error);
                    showNotification('‚ùå Erreur sauvegarde progression', 'error');
                    return false;
                }
            }

            static async updateLastAccessed(tdNumber) {
                if (!authManager.currentUser) return;

                try {
                    await supabase
                        .from('td_progress')
                        .upsert({
                            user_id: authManager.currentUser.id,
                            td_number: tdNumber,
                            last_accessed: new Date().toISOString()
                        }, { onConflict: 'user_id,td_number' });
                        
                } catch (error) {
                    console.error('‚ùå Erreur mise √† jour acc√®s:', error);
                }
            }
        }

        // Gestion newsletter
        class NewsletterManager {
            static async subscribe(email, userId = null) {
                try {
                    const { data: existing, error: checkError } = await supabase
                        .from('newsletter_subscriptions')
                        .select('*')
                        .eq('email', email)
                        .eq('is_active', true)
                        .single();

                    if (existing) {
                        return { success: false, error: 'Vous √™tes d√©j√† inscrit √† la newsletter' };
                    }

                    const subscriptionData = {
                        email: email,
                        user_id: userId,
                        subscribed_at: new Date().toISOString(),
                        is_active: true
                    };

                    console.log('üìß Inscription newsletter:', subscriptionData);

                    const { data, error } = await supabase
                        .from('newsletter_subscriptions')
                        .insert([subscriptionData])
                        .select()
                        .single();

                    if (error) throw error;
                    
                    console.log('‚úÖ Inscription newsletter r√©ussie');
                    return { success: true, data };
                    
                } catch (error) {
                    console.error('‚ùå Erreur inscription newsletter:', error);
                    return { success: false, error: error.message };
                }
            }
        }

        // Initialisation
        const authManager = new AuthManager();

        // √âv√©nements DOM - VERSION CORRIG√âE
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initialisation de Focus ISEP...');

            // Modal de connexion - CORRECTION DES √âV√âNEMENTS
            const loginModal = document.getElementById('loginModal');
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const closeModal = document.querySelector('.close-modal');
            const loginForm = document.getElementById('loginForm');

            // CORRECTION : S'assurer que le bouton login fonctionne
            if (loginBtn) {
                loginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üéØ Bouton connexion cliqu√©');
                    loginModal.style.display = 'block';
                });
            }

            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    authManager.logout();
                });
            }
            
            if (closeModal) {
                closeModal.addEventListener('click', function() {
                    loginModal.style.display = 'none';
                });
            }

            // Fermer modal en cliquant √† l'ext√©rieur
            window.addEventListener('click', function(e) {
                if (e.target === loginModal) {
                    loginModal.style.display = 'none';
                }
            });

            // Connexion
            if (loginForm) {
                loginForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const username = document.getElementById('username').value.trim();
                    const email = document.getElementById('email').value.trim();

                    if (username.length < 3) {
                        showNotification('‚ùå Le pseudo doit faire au moins 3 caract√®res', 'error');
                        return;
                    }

                    const result = await authManager.login(username, email);
                    
                    if (result.success) {
                        loginModal.style.display = 'none';
                        loginForm.reset();
                        showNotification(`üéâ Bienvenue ${username} !`, 'success');
                    } else {
                        showNotification('‚ùå ' + result.error, 'error');
                    }
                });
            }

            // Newsletter
            const newsletterForm = document.getElementById('newsletterForm');
            if (newsletterForm) {
                newsletterForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const email = document.getElementById('newsletterEmail').value.trim();
                    
                    const result = await NewsletterManager.subscribe(email, authManager.currentUser?.id);
                    
                    if (result.success) {
                        showNotification('‚úÖ Inscription √† la newsletter r√©ussie !', 'success');
                        newsletterForm.reset();
                    } else {
                        showNotification('‚ùå ' + result.error, 'error');
                    }
                });
            }

            // CORRECTION : Gestion des clics sur les TDs avec v√©rification de connexion
            document.querySelectorAll('.td-card:not(.locked-card)').forEach(card => {
                card.addEventListener('click', async function(e) {
                    e.preventDefault();
                    const tdNumber = parseInt(this.getAttribute('data-td'));
                    console.log('üéØ Clic sur TD:', tdNumber);
                    
                    if (!authManager.isLoggedIn()) {
                        showNotification('üîê Veuillez vous connecter pour acc√©der aux TDs', 'info');
                        loginModal.style.display = 'block';
                        return;
                    }

                    // Mettre √† jour le dernier acc√®s
                    await ProgressManager.updateLastAccessed(tdNumber);
                    
                    // Rediriger vers la page du TD
                    const tdPages = {
                        1: 'td1.html',
                        2: 'td2.html',
                        3: 'td3.html',
                        4: 'td4.html',
                        5: 'td5.html'
                    };
                    
                    const tdPage = tdPages[tdNumber];
                    if (tdPage) {
                        console.log('üîó Redirection vers:', tdPage);
                        window.location.href = tdPage;
                    } else {
                        showNotification('‚ùå Page TD non trouv√©e', 'error');
                    }
                });
            });

            // Navigation smooth scroll
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            console.log('‚úÖ Focus ISEP initialis√© avec succ√®s!');
        });

        // Fonction utilitaire pour les notifications
        function showNotification(message, type = 'info') {
            // Supprimer les notifications existantes
            document.querySelectorAll('.notification').forEach(n => n.remove());

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-message">${message}</span>
                    <button class="notification-close">&times;</button>
                </div>
            `;

            // Appliquer les styles
            Object.assign(notification.style, {
                position: 'fixed',
                top: '20px',
                right: '20px',
                padding: '0',
                borderRadius: '8px',
                zIndex: '10000',
                boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
                maxWidth: '400px',
                animation: 'slideInRight 0.3s ease'
            });

            // Couleurs selon le type
            const colors = {
                success: { bg: '#4CAF50', text: '#fff' },
                error: { bg: '#f44336', text: '#fff' },
                info: { bg: '#2196F3', text: '#fff' }
            };

            const color = colors[type] || colors.info;
            notification.style.background = color.bg;
            notification.style.color = color.text;

            document.body.appendChild(notification);

            // Bouton de fermeture
            notification.querySelector('.notification-close').addEventListener('click', function() {
                notification.remove();
            });

            // Fermeture automatique
            setTimeout(function() {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(function() {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 4000);
        }

        // Animation CSS pour les notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            
            .notification-content {
                padding: 15px 20px;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            
            .notification-close {
                background: none;
                border: none;
                color: inherit;
                font-size: 1.2rem;
                cursor: pointer;
                margin-left: 15px;
            }
            
            .notification-message {
                flex: 1;
            }
            
            .spinner {
                display: inline-block;
                width: 16px;
                height: 16px;
                border: 2px solid #ffffff;
                border-radius: 50%;
                border-top-color: transparent;
                animation: spin 1s ease-in-out infinite;
                margin-left: 8px;
            }
            
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
